let n="production";function t(t,e){if("development"==n)throw e;throw new Error(t)}function e(n,e,o){n&&t(e,o)}function o(t){n=t}const r={name:"DefaultPlugins",plugins:[new function(){const n=["name","hooks","init","allowKeys","disableKeyCheck","plugins","debug","preInit"];let e=!1;return{name:"ValidateConfigPlugin",hooks:{initPlugin(t,o){t.allowKeys&&n.push(...t.allowKeys),t.disableKeyCheck&&(e=t.disableKeyCheck)},pluginsInitialized(o){if(!e)for(let e of o.plugins)for(let o of Object.keys(e))n.includes(o)||t(`Config attribute "${o}" is used but not allowed. Allowed are ${n.join(", ")}. \n                            You want to disable this proove? set disableKeyCheck:true.\n                            You want to allow another config attributes? Add allowKeys:['yourkeyname'].`,"config.invalidKey")}},init:()=>({disableKeyCheck(){e=!0}})}},new function(n){return{name:"InitHooksPlugin",allowKeys:["addHooks","hooks"],hooks:{initPlugin:function(n,t){if(n.addHooks){e(Array.isArray(n.addHooks)||"object"!=typeof n.addHooks,`Error in plugin "${n.name}": config.addHooks must be an object but is a ${typeof n.addHooks}`,"config.addHooks.wrongtype");for(let e of Object.keys(n.addHooks))t.hooks[e]=n.addHooks[e]}if(n.hooks){e(Array.isArray(n.hooks)||"object"!=typeof n.hooks,`Error in plugin "${n.name}": config.hooks must be an object but is a ${typeof n.hooks}`,"config.hooks.wrongtype");for(let o of Object.keys(n.hooks))e(!t.hooks[o],'There is no Hook named "'+o+'", declared in plugin '+n.name+' . Is it correctly written? If yes, initialize it first with config attribute "addHooks"',"config.hooks.notDefined"),t.hooks[o].tap(n.name,n.hooks[o])}}},init:function(n,t,e){return n.hooks&&n.hooks.preInitPlugin&&e.hooks.preInitPlugin.tap("preInitPlugin",n.hooks.preInitPlugin),{addHooks:function(n){for(let t of Object.keys(n))e.hooks[t]=n[t]},on:function(n,t,o){if(!e.hooks[n])throw new Error('Hook with name "'+n+'" does not exist. context.on(name, pluginname, fn) failed');return e.hooks[n].tap(t,o)}}}}},new function(){return{allowKeys:["return"],name:"ReturnPlugin",hooks:{initPlugin(n,t){n.return&&(t.return=n.return)}}}},new function(){const n={};return{allowKeys:["rename"],name:"RenamePlugin",hooks:{initPlugin(t,e){if(t.rename){let e,o;for(o of Object.keys(t.rename))e=t.rename[o],n[o]=e}},return(t){let e,o;for(o of Object.keys(n))e=n[o],t[e]=t[o],delete t[o]}}}},new function(){const n=[];return{allowKeys:["delete"],name:"DeletePlugin",hooks:{initPlugin(t,e){t.delete&&n.push(...t.delete)},return(t){for(let e of n)delete t[e]}}}}]};class i{constructor(){this._listeners={}}tap(n,t){if(null==n)throw new Error("Hook.on(): should be on(name:string, listener:function) but name is undefined");if(null==t)throw new Error("Hook.on(): should be on(name:string, listener:function) but listener is undefined");this._listeners[n]=t}off(n){if(null==n)throw new Error("Hook.off(): should be on(name:string, listener:function) but name is undefined");delete this._listeners[n]}listeners(n){return n?this._listeners[n]:Object.values(this._listeners)}}class u extends i{call(n){const t=this.listeners();for(let n of t)n(...arguments)}}class a extends i{async promise(n){const t=this.listeners();for(let n of t)await n(...arguments)}}class l extends i{call(n){let t=n;const e=this.listeners();for(let n of e){if(null==t)throw new Error("A listener in SyncWaterfallHook.trigger(context) returns null. This is not allowed. Did you forget returning sth in a listener?");t=n(t,...arguments)}return t}}class c extends i{async promise(n){let t=n;const e=this.listeners();for(let n of e)t=await n(t,...arguments);return t}}class s extends i{call(n){const t=this.listeners();for(let n of t){if(!n(...arguments))return}}}class f extends i{async call(n){const t=this.listeners();for(let n of t){if(!await n(...arguments))return}}}var g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var p,y,h=(function(n,t){var e="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",i="[object Boolean]",u="[object Date]",a="[object Function]",l="[object GeneratorFunction]",c="[object Map]",s="[object Number]",f="[object Object]",p="[object Promise]",y="[object RegExp]",h="[object Set]",d="[object String]",b="[object Symbol]",w="[object WeakMap]",_="[object ArrayBuffer]",m="[object DataView]",k="[object Float32Array]",j="[object Float64Array]",v="[object Int8Array]",P="[object Int16Array]",A="[object Int32Array]",I="[object Uint8Array]",x="[object Uint8ClampedArray]",O="[object Uint16Array]",$="[object Uint32Array]",C=/\w*$/,z=/^\[object .+?Constructor\]$/,E=/^(?:0|[1-9]\d*)$/,H={};H[r]=H["[object Array]"]=H[_]=H[m]=H[i]=H[u]=H[k]=H[j]=H[v]=H[P]=H[A]=H[c]=H[s]=H[f]=H[y]=H[h]=H[d]=H[b]=H[I]=H[x]=H[O]=H[$]=!0,H["[object Error]"]=H[a]=H[w]=!1;var S="object"==typeof g&&g&&g.Object===Object&&g,T="object"==typeof self&&self&&self.Object===Object&&self,K=S||T||Function("return this")(),N=t&&!t.nodeType&&t,D=N&&n&&!n.nodeType&&n,F=D&&D.exports===N;function B(n,t){return n.set(t[0],t[1]),n}function R(n,t){return n.add(t),n}function U(n,t,e,o){var r=-1,i=n?n.length:0;for(o&&i&&(e=n[++r]);++r<i;)e=t(e,n[r],r,n);return e}function M(n){var t=!1;if(null!=n&&"function"!=typeof n.toString)try{t=!!(n+"")}catch(n){}return t}function V(n){var t=-1,e=Array(n.size);return n.forEach((function(n,o){e[++t]=[o,n]})),e}function W(n,t){return function(e){return n(t(e))}}function q(n){var t=-1,e=Array(n.size);return n.forEach((function(n){e[++t]=n})),e}var J,L=Array.prototype,Y=Function.prototype,G=Object.prototype,Q=K["__core-js_shared__"],X=(J=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",Z=Y.toString,nn=G.hasOwnProperty,tn=G.toString,en=RegExp("^"+Z.call(nn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),on=F?K.Buffer:void 0,rn=K.Symbol,un=K.Uint8Array,an=W(Object.getPrototypeOf,Object),ln=Object.create,cn=G.propertyIsEnumerable,sn=L.splice,fn=Object.getOwnPropertySymbols,gn=on?on.isBuffer:void 0,pn=W(Object.keys,Object),yn=Fn(K,"DataView"),hn=Fn(K,"Map"),dn=Fn(K,"Promise"),bn=Fn(K,"Set"),wn=Fn(K,"WeakMap"),_n=Fn(Object,"create"),mn=Vn(yn),kn=Vn(hn),jn=Vn(dn),vn=Vn(bn),Pn=Vn(wn),An=rn?rn.prototype:void 0,In=An?An.valueOf:void 0;function xn(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function On(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function $n(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function Cn(n){this.__data__=new On(n)}function zn(n,t){var e=qn(n)||function(n){return function(n){return function(n){return!!n&&"object"==typeof n}(n)&&Jn(n)}(n)&&nn.call(n,"callee")&&(!cn.call(n,"callee")||tn.call(n)==r)}(n)?function(n,t){for(var e=-1,o=Array(n);++e<n;)o[e]=t(e);return o}(n.length,String):[],o=e.length,i=!!o;for(var u in n)!t&&!nn.call(n,u)||i&&("length"==u||Un(u,o))||e.push(u);return e}function En(n,t,e){var o=n[t];nn.call(n,t)&&Wn(o,e)&&(void 0!==e||t in n)||(n[t]=e)}function Hn(n,t){for(var e=n.length;e--;)if(Wn(n[e][0],t))return e;return-1}function Sn(n,t,e,o,g,p,w){var z;if(o&&(z=p?o(n,g,p,w):o(n)),void 0!==z)return z;if(!Gn(n))return n;var E=qn(n);if(E){if(z=function(n){var t=n.length,e=n.constructor(t);return t&&"string"==typeof n[0]&&nn.call(n,"index")&&(e.index=n.index,e.input=n.input),e}(n),!t)return function(n,t){var e=-1,o=n.length;for(t||(t=Array(o));++e<o;)t[e]=n[e];return t}(n,z)}else{var S=Rn(n),T=S==a||S==l;if(Ln(n))return function(n,t){if(t)return n.slice();var e=new n.constructor(n.length);return n.copy(e),e}(n,t);if(S==f||S==r||T&&!p){if(M(n))return p?n:{};if(z=function(n){return"function"!=typeof n.constructor||Mn(n)?{}:Gn(t=an(n))?ln(t):{};var t}(T?{}:n),!t)return function(n,t){return Nn(n,Bn(n),t)}(n,function(n,t){return n&&Nn(t,Qn(t),n)}(z,n))}else{if(!H[S])return p?n:{};z=function(n,t,e,o){var r,a=n.constructor;switch(t){case _:return Kn(n);case i:case u:return new a(+n);case m:return function(n,t){var e=t?Kn(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.byteLength)}(n,o);case k:case j:case v:case P:case A:case I:case x:case O:case $:return function(n,t){var e=t?Kn(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.length)}(n,o);case c:return function(n,t,e){return U(t?e(V(n),!0):V(n),B,new n.constructor)}(n,o,e);case s:case d:return new a(n);case y:return function(n){var t=new n.constructor(n.source,C.exec(n));return t.lastIndex=n.lastIndex,t}(n);case h:return function(n,t,e){return U(t?e(q(n),!0):q(n),R,new n.constructor)}(n,o,e);case b:return r=n,In?Object(In.call(r)):{}}}(n,S,Sn,t)}}w||(w=new Cn);var K=w.get(n);if(K)return K;if(w.set(n,z),!E)var N=e?function(n){return function(n,t,e){var o=t(n);return qn(n)?o:function(n,t){for(var e=-1,o=t.length,r=n.length;++e<o;)n[r+e]=t[e];return n}(o,e(n))}(n,Qn,Bn)}(n):Qn(n);return function(n,t){for(var e=-1,o=n?n.length:0;++e<o&&!1!==t(n[e],e,n););}(N||n,(function(r,i){N&&(r=n[i=r]),En(z,i,Sn(r,t,e,o,i,n,w))})),z}function Tn(n){return!(!Gn(n)||(t=n,X&&X in t))&&(Yn(n)||M(n)?en:z).test(Vn(n));var t}function Kn(n){var t=new n.constructor(n.byteLength);return new un(t).set(new un(n)),t}function Nn(n,t,e,o){e||(e={});for(var r=-1,i=t.length;++r<i;){var u=t[r],a=o?o(e[u],n[u],u,e,n):void 0;En(e,u,void 0===a?n[u]:a)}return e}function Dn(n,t){var e,o,r=n.__data__;return("string"==(o=typeof(e=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==e:null===e)?r["string"==typeof t?"string":"hash"]:r.map}function Fn(n,t){var e=function(n,t){return null==n?void 0:n[t]}(n,t);return Tn(e)?e:void 0}xn.prototype.clear=function(){this.__data__=_n?_n(null):{}},xn.prototype.delete=function(n){return this.has(n)&&delete this.__data__[n]},xn.prototype.get=function(n){var t=this.__data__;if(_n){var o=t[n];return o===e?void 0:o}return nn.call(t,n)?t[n]:void 0},xn.prototype.has=function(n){var t=this.__data__;return _n?void 0!==t[n]:nn.call(t,n)},xn.prototype.set=function(n,t){return this.__data__[n]=_n&&void 0===t?e:t,this},On.prototype.clear=function(){this.__data__=[]},On.prototype.delete=function(n){var t=this.__data__,e=Hn(t,n);return!(e<0||(e==t.length-1?t.pop():sn.call(t,e,1),0))},On.prototype.get=function(n){var t=this.__data__,e=Hn(t,n);return e<0?void 0:t[e][1]},On.prototype.has=function(n){return Hn(this.__data__,n)>-1},On.prototype.set=function(n,t){var e=this.__data__,o=Hn(e,n);return o<0?e.push([n,t]):e[o][1]=t,this},$n.prototype.clear=function(){this.__data__={hash:new xn,map:new(hn||On),string:new xn}},$n.prototype.delete=function(n){return Dn(this,n).delete(n)},$n.prototype.get=function(n){return Dn(this,n).get(n)},$n.prototype.has=function(n){return Dn(this,n).has(n)},$n.prototype.set=function(n,t){return Dn(this,n).set(n,t),this},Cn.prototype.clear=function(){this.__data__=new On},Cn.prototype.delete=function(n){return this.__data__.delete(n)},Cn.prototype.get=function(n){return this.__data__.get(n)},Cn.prototype.has=function(n){return this.__data__.has(n)},Cn.prototype.set=function(n,t){var e=this.__data__;if(e instanceof On){var o=e.__data__;if(!hn||o.length<199)return o.push([n,t]),this;e=this.__data__=new $n(o)}return e.set(n,t),this};var Bn=fn?W(fn,Object):function(){return[]},Rn=function(n){return tn.call(n)};function Un(n,t){return!!(t=null==t?o:t)&&("number"==typeof n||E.test(n))&&n>-1&&n%1==0&&n<t}function Mn(n){var t=n&&n.constructor;return n===("function"==typeof t&&t.prototype||G)}function Vn(n){if(null!=n){try{return Z.call(n)}catch(n){}try{return n+""}catch(n){}}return""}function Wn(n,t){return n===t||n!=n&&t!=t}(yn&&Rn(new yn(new ArrayBuffer(1)))!=m||hn&&Rn(new hn)!=c||dn&&Rn(dn.resolve())!=p||bn&&Rn(new bn)!=h||wn&&Rn(new wn)!=w)&&(Rn=function(n){var t=tn.call(n),e=t==f?n.constructor:void 0,o=e?Vn(e):void 0;if(o)switch(o){case mn:return m;case kn:return c;case jn:return p;case vn:return h;case Pn:return w}return t});var qn=Array.isArray;function Jn(n){return null!=n&&function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=o}(n.length)&&!Yn(n)}var Ln=gn||function(){return!1};function Yn(n){var t=Gn(n)?tn.call(n):"";return t==a||t==l}function Gn(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function Qn(n){return Jn(n)?zn(n):function(n){if(!Mn(n))return pn(n);var t=[];for(var e in Object(n))nn.call(n,e)&&"constructor"!=e&&t.push(e);return t}(n)}n.exports=function(n){return Sn(n,!0,!0)}}(y={path:p,exports:{},require:function(n,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&y.path)}},y.exports),y.exports);const d=function n(t={},i={}){function s(i={}){const s=h(Object.assign({configs:[]},t));let f=Array.isArray(i)?i:[i];f=f.map((n=>(n.name=n.name||"pluginize(config)",n))),s.configs.push(...f);return new n(s,{runPromise:function(n){async function t(n,o){if(o.log('- Add plugin "'+n.name+'"'),e(!(n=await o.hooks.preInitPlugin.promise(n,o)||n).name,`Plugin ${JSON.stringify(n)} has no name. Please define a name by adding an attribute name:"pluginname" to your plugin.`,"plugin.noName"),e("function"==typeof n,`Plugin ${n.name} is a function, but should be a configuration object. Did you forget calling it? (eg: PluginName())`,"plugin.isFunction"),e("object"!=typeof n||Array.isArray(n),`Plugin ${n.name} should be a configuration of type object, but is typeof ${typeof n}.`,"plugin.wrongType"),o.plugins.push(n),n.init){e("function"!=typeof n.init,`Error in plugin "${n.name}": config.init must be a function but is a ${typeof n.init}`,"config.init.wrongtype"),o.log("- Execute init() function of plugin "+n.name);const t=await n.init(o.config,n,o);if(t&&!t._context&&"object"==typeof t&&!Array.isArray(t))for(let n of Object.keys(t)||{})o.log("- add "+n+" to global context."),o[n]=t[n]}n.hooks&&n.hooks.initPlugin&&await o.hooks.initPlugin.tap(n.name,n.hooks.initPlugin),e(n.plugins&&!Array.isArray(n.plugins),`Error in plugin "${n.name}": config.plugin must be an array but is an ${typeof n.plugins}`,"config.plugin.wrongtype");for(let e of n.plugins||[])await t(e,o);return o}return async function(i={}){let u={plugins:[],config:i,_context:!0,addPlugin:t,hooks:{return:new a(["context"]),preInitPlugin:new c(["config","context"]),pluginsInitialized:new a(["context"]),initPlugin:new a(["plugin","context"])},log(){i.debug&&console.log(...arguments)}};for(let t of n.configs)t.preInit&&t.preInit(i,u);e(null==i,"pluginize(config,factoryConfig): factoryConfig.preInit returns null but should return the modified config.","factoryConfig.preInit.isNull"),e("object"!=typeof i,"pluginize(config,factoryConfig): factoryConfig.preInit returns a "+typeof entry+"but should return an object.","factoryConfig.preInit.wrongType"),e(Array.isArray(i),"pluginize(config,factoryConfig): factoryConfig.preInit returns an Array but should return an object.","factoryConfig.preInit.wrongTypeArray"),i.debug&&o("development"),i.name||(i.name="PluginizeAsync"),u.log("Starting Pluginize."),await t(r,u);for(let e of n.configs)await t(e,u);await t(i,u);for(let n of u.plugins)e(null==n,"error in Pluginize(config): hook preInitPlugin - a listener returns null but should  return an object (the modified config)","config.preInit.returnNull"),e(Array.isArray(n)||"object"!=typeof n,"error in Pluginize(config): hook preInitPlugin - a listener should return an object (the modified config) but returns a "+typeof n,"config.preInit.wrongType"),u.log('- call hook "initPlugin" of plugin '+n.name),await u.hooks.initPlugin.promise(n,u);return u.log('- call hook "pluginsInitialized"'),await u.hooks.pluginsInitialized.promise(u),await u.hooks.return.promise(u),u.return?u[u.return]:u}}(s),run:function(n){function t(n,o){if(o.log('- Add plugin "'+n.name+'"'),e(null==(n=o.hooks.preInitPlugin.call(n,o)||n),"Error: Plugin is null","conf.isNull"),e(!n.name,`Plugin ${JSON.stringify(n)} has no name. Please define a name by adding an attribute name:"pluginname" to your plugin.`,"plugin.noName"),e("function"==typeof n,`Plugin ${n.name} is a function, but should be a configuration object. Did you forget calling it? (eg: PluginName())`,"plugin.isFunction"),e("object"!=typeof n||Array.isArray(n),`Plugin ${n.name} should be a configuration of type object, but is typeof ${typeof n}.`,"plugin.wrongType"),o.plugins.push(n),n.init){e("function"!=typeof n.init,`Error in plugin "${n.name}": config.init must be a function but is a ${typeof n.init}`,"config.init.wrongtype"),o.log("- Execute init() function of plugin "+n.name);const t=n.init(o.config,n,o);if(t&&!t._context&&"object"==typeof t&&!Array.isArray(t))for(let n of Object.keys(t)||{})o.log("- add "+n+" to global context."),o[n]=t[n]}n.hooks&&n.hooks.initPlugin&&o.hooks.initPlugin.tap(n.name,n.hooks.initPlugin),e(n.plugins&&!Array.isArray(n.plugins),`Error in plugin "${n.name}": config.plugin must be an array but is an ${typeof n.plugins}`,"config.plugin.wrongtype");for(let e of n.plugins||[])t(e,o);return o}return function(i={}){let a={plugins:[],config:i,_context:!0,addPlugin:t,hooks:{return:new u(["context"]),preInitPlugin:new l(["config","context"]),pluginsInitialized:new u(["context"]),initPlugin:new u(["plugin","context"])},log(){i.debug&&console.log(...arguments)}};for(let t of n.configs)t.preInit&&t.preInit(i,a);e(null==i,"pluginize(config,factoryConfig): factoryConfig.preInit returns null but should return the modified config.","factoryConfig.preInit.isNull"),e("object"!=typeof i,"pluginize(config,factoryConfig): factoryConfig.preInit returns a "+typeof entry+"but should return an object.","factoryConfig.preInit.wrongType"),e(Array.isArray(i),"pluginize(config,factoryConfig): factoryConfig.preInit returns an Array but should return an object.","factoryConfig.preInit.wrongTypeArray"),i.debug&&o("development"),i.name||(i.name="Pluginize"),a.log("Starting Pluginize."),t(r,a);for(let e of n.configs)t(e,a);t(i,a);for(let n of a.plugins)e(null==n,"error in Pluginize(config): hook preInitPlugin - a listener returns null but should  return an object (the modified config)","config.preInit.returnNull"),e(Array.isArray(n)||"object"!=typeof n,"error in Pluginize(config): hook preInitPlugin - a listener should return an object (the modified config) but returns a "+typeof n,"config.preInit.wrongType"),a.log('- call hook "initPlugin" of plugin '+n.name),a.hooks.initPlugin.call(n,a);return a.log('- call hook "pluginsInitialized"'),a.hooks.pluginsInitialized.call(a),a.hooks.return.call(a),a.return?a[a.return]:a}}(s),factoryConfig:Object.assign(s,{level:s.level+1})})}for(let n of Object.keys(i))s[n]=i[n];return s}({level:0});export{f as AsyncBreakableHook,a as AsyncHook,c as AsyncWaterfallHook,s as SyncBreakableHook,u as SyncHook,l as SyncWaterfallHook,d as pluginize};
