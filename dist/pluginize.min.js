!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).pluginize={})}(this,(function(n){"use strict";let t="production";function e(n,e){if("development"==t)throw e;throw new Error(n)}function o(n,t,o){n&&e(t,o)}function r(n){t=n}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var u=function(n,t,e){return n(e={path:t,exports:{},require:function(n,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&e.path)}},e.exports),e.exports}((function(n,t){var e="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",u="[object Boolean]",a="[object Date]",l="[object Function]",c="[object GeneratorFunction]",f="[object Map]",s="[object Number]",g="[object Object]",p="[object Promise]",y="[object RegExp]",d="[object Set]",b="[object String]",h="[object Symbol]",_="[object WeakMap]",w="[object ArrayBuffer]",P="[object DataView]",m="[object Float32Array]",I="[object Float64Array]",v="[object Int8Array]",j="[object Int16Array]",A="[object Int32Array]",O="[object Uint8Array]",k="[object Uint8ClampedArray]",x="[object Uint16Array]",z="[object Uint32Array]",C=/\w*$/,$=/^\[object .+?Constructor\]$/,E=/^(?:0|[1-9]\d*)$/,S={};S[r]=S["[object Array]"]=S[w]=S[P]=S[u]=S[a]=S[m]=S[I]=S[v]=S[j]=S[A]=S[f]=S[s]=S[g]=S[y]=S[d]=S[b]=S[h]=S[O]=S[k]=S[x]=S[z]=!0,S["[object Error]"]=S[l]=S[_]=!1;var R="object"==typeof i&&i&&i.Object===Object&&i,T="object"==typeof self&&self&&self.Object===Object&&self,K=R||T||Function("return this")(),H=t&&!t.nodeType&&t,N=H&&n&&!n.nodeType&&n,D=N&&N.exports===H;function F(n,t){return n.set(t[0],t[1]),n}function B(n,t){return n.add(t),n}function M(n,t,e,o){var r=-1,i=n?n.length:0;for(o&&i&&(e=n[++r]);++r<i;)e=t(e,n[r],r,n);return e}function U(n){var t=!1;if(null!=n&&"function"!=typeof n.toString)try{t=!!(n+"")}catch(n){}return t}function W(n){var t=-1,e=Array(n.size);return n.forEach((function(n,o){e[++t]=[o,n]})),e}function V(n,t){return function(e){return n(t(e))}}function q(n){var t=-1,e=Array(n.size);return n.forEach((function(n){e[++t]=n})),e}var J,L=Array.prototype,Y=Function.prototype,G=Object.prototype,Q=K["__core-js_shared__"],X=(J=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",Z=Y.toString,nn=G.hasOwnProperty,tn=G.toString,en=RegExp("^"+Z.call(nn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),on=D?K.Buffer:void 0,rn=K.Symbol,un=K.Uint8Array,an=V(Object.getPrototypeOf,Object),ln=Object.create,cn=G.propertyIsEnumerable,fn=L.splice,sn=Object.getOwnPropertySymbols,gn=on?on.isBuffer:void 0,pn=V(Object.keys,Object),yn=Dn(K,"DataView"),dn=Dn(K,"Map"),bn=Dn(K,"Promise"),hn=Dn(K,"Set"),_n=Dn(K,"WeakMap"),wn=Dn(Object,"create"),Pn=Wn(yn),mn=Wn(dn),In=Wn(bn),vn=Wn(hn),jn=Wn(_n),An=rn?rn.prototype:void 0,On=An?An.valueOf:void 0;function kn(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function xn(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function zn(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function Cn(n){this.__data__=new xn(n)}function $n(n,t){var e=qn(n)||function(n){return function(n){return function(n){return!!n&&"object"==typeof n}(n)&&Jn(n)}(n)&&nn.call(n,"callee")&&(!cn.call(n,"callee")||tn.call(n)==r)}(n)?function(n,t){for(var e=-1,o=Array(n);++e<n;)o[e]=t(e);return o}(n.length,String):[],o=e.length,i=!!o;for(var u in n)!t&&!nn.call(n,u)||i&&("length"==u||Mn(u,o))||e.push(u);return e}function En(n,t,e){var o=n[t];nn.call(n,t)&&Vn(o,e)&&(void 0!==e||t in n)||(n[t]=e)}function Sn(n,t){for(var e=n.length;e--;)if(Vn(n[e][0],t))return e;return-1}function Rn(n,t,e,o,i,p,_){var $;if(o&&($=p?o(n,i,p,_):o(n)),void 0!==$)return $;if(!Gn(n))return n;var E=qn(n);if(E){if($=function(n){var t=n.length,e=n.constructor(t);t&&"string"==typeof n[0]&&nn.call(n,"index")&&(e.index=n.index,e.input=n.input);return e}(n),!t)return function(n,t){var e=-1,o=n.length;t||(t=Array(o));for(;++e<o;)t[e]=n[e];return t}(n,$)}else{var R=Bn(n),T=R==l||R==c;if(Ln(n))return function(n,t){if(t)return n.slice();var e=new n.constructor(n.length);return n.copy(e),e}(n,t);if(R==g||R==r||T&&!p){if(U(n))return p?n:{};if($=function(n){return"function"!=typeof n.constructor||Un(n)?{}:(t=an(n),Gn(t)?ln(t):{});var t}(T?{}:n),!t)return function(n,t){return Hn(n,Fn(n),t)}(n,function(n,t){return n&&Hn(t,Qn(t),n)}($,n))}else{if(!S[R])return p?n:{};$=function(n,t,e,o){var r=n.constructor;switch(t){case w:return Kn(n);case u:case a:return new r(+n);case P:return function(n,t){var e=t?Kn(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.byteLength)}(n,o);case m:case I:case v:case j:case A:case O:case k:case x:case z:return function(n,t){var e=t?Kn(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.length)}(n,o);case f:return function(n,t,e){return M(t?e(W(n),!0):W(n),F,new n.constructor)}(n,o,e);case s:case b:return new r(n);case y:return function(n){var t=new n.constructor(n.source,C.exec(n));return t.lastIndex=n.lastIndex,t}(n);case d:return function(n,t,e){return M(t?e(q(n),!0):q(n),B,new n.constructor)}(n,o,e);case h:return i=n,On?Object(On.call(i)):{}}var i}(n,R,Rn,t)}}_||(_=new Cn);var K=_.get(n);if(K)return K;if(_.set(n,$),!E)var H=e?function(n){return function(n,t,e){var o=t(n);return qn(n)?o:function(n,t){for(var e=-1,o=t.length,r=n.length;++e<o;)n[r+e]=t[e];return n}(o,e(n))}(n,Qn,Fn)}(n):Qn(n);return function(n,t){for(var e=-1,o=n?n.length:0;++e<o&&!1!==t(n[e],e,n););}(H||n,(function(r,i){H&&(r=n[i=r]),En($,i,Rn(r,t,e,o,i,n,_))})),$}function Tn(n){return!(!Gn(n)||(t=n,X&&X in t))&&(Yn(n)||U(n)?en:$).test(Wn(n));var t}function Kn(n){var t=new n.constructor(n.byteLength);return new un(t).set(new un(n)),t}function Hn(n,t,e,o){e||(e={});for(var r=-1,i=t.length;++r<i;){var u=t[r],a=o?o(e[u],n[u],u,e,n):void 0;En(e,u,void 0===a?n[u]:a)}return e}function Nn(n,t){var e,o,r=n.__data__;return("string"==(o=typeof(e=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==e:null===e)?r["string"==typeof t?"string":"hash"]:r.map}function Dn(n,t){var e=function(n,t){return null==n?void 0:n[t]}(n,t);return Tn(e)?e:void 0}kn.prototype.clear=function(){this.__data__=wn?wn(null):{}},kn.prototype.delete=function(n){return this.has(n)&&delete this.__data__[n]},kn.prototype.get=function(n){var t=this.__data__;if(wn){var o=t[n];return o===e?void 0:o}return nn.call(t,n)?t[n]:void 0},kn.prototype.has=function(n){var t=this.__data__;return wn?void 0!==t[n]:nn.call(t,n)},kn.prototype.set=function(n,t){return this.__data__[n]=wn&&void 0===t?e:t,this},xn.prototype.clear=function(){this.__data__=[]},xn.prototype.delete=function(n){var t=this.__data__,e=Sn(t,n);return!(e<0)&&(e==t.length-1?t.pop():fn.call(t,e,1),!0)},xn.prototype.get=function(n){var t=this.__data__,e=Sn(t,n);return e<0?void 0:t[e][1]},xn.prototype.has=function(n){return Sn(this.__data__,n)>-1},xn.prototype.set=function(n,t){var e=this.__data__,o=Sn(e,n);return o<0?e.push([n,t]):e[o][1]=t,this},zn.prototype.clear=function(){this.__data__={hash:new kn,map:new(dn||xn),string:new kn}},zn.prototype.delete=function(n){return Nn(this,n).delete(n)},zn.prototype.get=function(n){return Nn(this,n).get(n)},zn.prototype.has=function(n){return Nn(this,n).has(n)},zn.prototype.set=function(n,t){return Nn(this,n).set(n,t),this},Cn.prototype.clear=function(){this.__data__=new xn},Cn.prototype.delete=function(n){return this.__data__.delete(n)},Cn.prototype.get=function(n){return this.__data__.get(n)},Cn.prototype.has=function(n){return this.__data__.has(n)},Cn.prototype.set=function(n,t){var e=this.__data__;if(e instanceof xn){var o=e.__data__;if(!dn||o.length<199)return o.push([n,t]),this;e=this.__data__=new zn(o)}return e.set(n,t),this};var Fn=sn?V(sn,Object):function(){return[]},Bn=function(n){return tn.call(n)};function Mn(n,t){return!!(t=null==t?o:t)&&("number"==typeof n||E.test(n))&&n>-1&&n%1==0&&n<t}function Un(n){var t=n&&n.constructor;return n===("function"==typeof t&&t.prototype||G)}function Wn(n){if(null!=n){try{return Z.call(n)}catch(n){}try{return n+""}catch(n){}}return""}function Vn(n,t){return n===t||n!=n&&t!=t}(yn&&Bn(new yn(new ArrayBuffer(1)))!=P||dn&&Bn(new dn)!=f||bn&&Bn(bn.resolve())!=p||hn&&Bn(new hn)!=d||_n&&Bn(new _n)!=_)&&(Bn=function(n){var t=tn.call(n),e=t==g?n.constructor:void 0,o=e?Wn(e):void 0;if(o)switch(o){case Pn:return P;case mn:return f;case In:return p;case vn:return d;case jn:return _}return t});var qn=Array.isArray;function Jn(n){return null!=n&&function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=o}(n.length)&&!Yn(n)}var Ln=gn||function(){return!1};function Yn(n){var t=Gn(n)?tn.call(n):"";return t==l||t==c}function Gn(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function Qn(n){return Jn(n)?$n(n):function(n){if(!Un(n))return pn(n);var t=[];for(var e in Object(n))nn.call(n,e)&&"constructor"!=e&&t.push(e);return t}(n)}n.exports=function(n){return Rn(n,!0,!0)}}));const a={name:"DefaultPlugins",plugins:[new function(){const n=["name","onInit","onPreInit","allowKeys","disableKeyCheck","plugins","debug","onInitPlugin","onPreInitPlugin","_pluginizeInternal"];let t=!1;return{_pluginizeInternal:!0,name:"ValidateConfigPlugin",onInitPlugin(e,o){e.allowKeys&&n.push(...e.allowKeys),e.disableKeyCheck&&(t=e.disableKeyCheck)},onPluginsInitialized(o){if(!t)for(let t of o.plugins)for(let o of Object.keys(t))n.includes(o)||e(`Config attribute "${o}" is used but not allowed. Allowed are ${n.join(", ")}. \n                            You want to disable this proove? set disableKeyCheck:true.\n                            You want to allow another config attributes? Add allowKeys:['yourkeyname'].`,"config.invalidKey")},onInit:()=>({disableKeyCheck(){t=!0}})}},new function(n){return{_pluginizeInternal:!0,name:"InitHooksPlugin",allowKeys:["onReturn","onPreInitPlugin","onPluginsInitialized"],onInit:function(n,t,e){n.onPreInitPlugin&&e.onPreInitPlugin.tap("onPreInitPlugin",n.onPreInitPlugin)},onInitPlugin(n,t){n.onReturn&&t.onReturn.tap(n.name,n.onReturn),n.onPluginsInitialized&&t.onPluginsInitialized.tap(n.name,n.onPluginsInitialized)}}},new function(){return{_pluginizeInternal:!0,allowKeys:["return"],name:"ReturnPlugin",onInitPlugin(n,t){n.return&&(t.return=n.return)}}},new function(){const n={};return{_pluginizeInternal:!0,allowKeys:["clone"],name:"ClonePlugin",onInitPlugin(t,e){if(t.clone){let e,o;for(o of Object.keys(t.clone))e=t.clone[o],n[o]=e}},onReturn(t){let e,o;for(o of Object.keys(n))e=n[o],t[e]=u(t[o])}}},new function(){const n={};return{_pluginizeInternal:!0,allowKeys:["rename"],name:"RenamePlugin",onReturn(t){let e,o;for(o of Object.keys(n))e=n[o],t[e]=t[o],delete t[o]},onInitPlugin(t,e){if(t.rename){let e,o;for(o of Object.keys(t.rename))e=t.rename[o],n[o]=e}}}},new function(){const n=[];return{_pluginizeInternal:!0,allowKeys:["delete"],name:"DeletePlugin",onReturn(t){for(let e of n)delete t[e]},onInitPlugin(t,e){t.delete&&n.push(...t.delete)}}}]};class l{constructor(){this._listeners={}}tap(n,t){if(null==n)throw new Error("Hook.on(): should be on(name:string, listener:function) but name is undefined");if(this._listeners[n])throw new Error('Hook.on(name:string, listener:function): a listener with name "'+n+'" already exists - choose another name.');if(null==t)throw new Error("Hook.on(): should be on(name:string, listener:function) but listener is undefined");this._listeners[n]=t}off(n){if(null==n)throw new Error("Hook.off(): should be on(name:string, listener:function) but name is undefined");delete this._listeners[n]}listeners(n){return n?this._listeners[n]:Object.values(this._listeners)}}class c extends l{call(n){const t=this.listeners();for(let n of t)n(...arguments)}}class f extends l{async promise(n){const t=this.listeners();for(let n of t)await n(...arguments)}}class s extends l{call(n){let t=n;const e=this.listeners();for(let n of e){if(null==t)throw new Error("A listener in SyncWaterfallHook.trigger(context) returns null. This is not allowed. Did you forget returning sth in a listener?");t=n(t,...arguments)}return t}}class g extends l{async promise(n){let t=n;const e=this.listeners();for(let n of e)t=await n(t,...arguments);return t}}function p(n,t){let e;for(e of(t(n),n.plugins||[]))p(e,t)}async function y(n,t){let e;for(e of(t(n),n.plugins||[]))await y(e,t)}const d=function n(t={},e={}){function i(e={}){const i=u(Object.assign({configs:[]},t));let l=Array.isArray(e)?e:[e];l=l.map((n=>(n.name=n.name||"pluginize(config)",n))),i.configs.push(...l);return new n(i,{runPromise:function(n){async function t(n,e){if(e.log('- Add plugin "'+n.name+'"'),o(!(n=await e.onPreInitPlugin.promise(n,e)||n).name,`Plugin ${JSON.stringify(n)} has no name. Please define a name by adding an attribute name:"pluginname" to your plugin.`,"plugin.noName"),o("function"==typeof n,`Plugin ${n.name} is a function, but should be a configuration object. Did you forget calling it? (eg: PluginName())`,"plugin.isFunction"),o("object"!=typeof n||Array.isArray(n),`Plugin ${n.name} should be a configuration of type object, but is typeof ${typeof n}.`,"plugin.wrongType"),e.plugins.push(n),n.onInit){o("function"!=typeof n.onInit,`Error in plugin "${n.name}": config.onInit must be a function but is a ${typeof n.onInit}`,"config.onInit.wrongtype"),e.log("- Execute onInit() function of plugin "+n.name);const t=await n.onInit(e.config,n,e);if(t&&!t._context&&"object"==typeof t&&!Array.isArray(t))for(let n of Object.keys(t)||{})e.log("- add "+n+" to global context."),e[n]=t[n]}n.onInitPlugin&&await e.onInitPlugin.tap(n.name,n.onInitPlugin),o(n.plugins&&!Array.isArray(n.plugins),`Error in plugin "${n.name}": config.plugin must be an array but is an ${typeof n.plugins}`,"config.plugin.wrongtype");for(let o of n.plugins||[])await t(o,e);return e}return async function(e={}){let i={plugins:[],config:e=Object.assign(e,n.configs[n.configs.length-1]||{}),_context:!0,addPlugin:t,onInitPlugin:new f(["plugin","context"]),onPreInitPlugin:new g(["config","context"]),onReturn:new f(["context"]),onPluginsInitialized:new f(["context"]),log(){e.debug&&console.log(...arguments)}};for(let t of n.configs)await y(t,(async n=>{n.onPreInit&&await n.onPreInit(e,i)}));o(null==e,"pluginize(config,factoryConfig): factoryConfig.onPreInit returns null but should return the modified config.","factoryConfig.preInit.isNull"),o("object"!=typeof e,"pluginize(config,factoryConfig): factoryConfig.onPreInit returns a "+typeof entry+"but should return an object.","factoryConfig.preInit.wrongType"),o(Array.isArray(e),"pluginize(config,factoryConfig): factoryConfig.onPreInit returns an Array but should return an object.","factoryConfig.preInit.wrongTypeArray"),e.debug&&r("development"),e.name||(e.name="PluginizeAsync"),i.log("Starting Pluginize."),await t(a,i);for(let e of n.configs)await t(e,i);await t(e,i);for(let n of i.plugins)o(null==n,"error in Pluginize(config): hook onPreInitPlugin - a listener returns null but should  return an object (the modified config)","config.preInit.returnNull"),o(Array.isArray(n)||"object"!=typeof n,"error in Pluginize(config): hook onPreInitPlugin - a listener should return an object (the modified config) but returns a "+typeof n,"config.preInit.wrongType"),i.log('- call hook "onInitPlugin" of plugin '+n.name),await i.onInitPlugin.promise(n,i);return i.log('- call hook "onPluginsInitialized"'),await i.onPluginsInitialized.promise(i),await i.onReturn.promise(i),i.return?i[i.return]:i}}(i),run:function(n){function t(n,e){if(e.log('- Add plugin "'+n.name+'"'),o(null==(n=e.onPreInitPlugin.call(n,e)||n),"Error: Plugin is null","conf.isNull"),o(!n.name,`Plugin ${JSON.stringify(n)} has no name. Please define a name by adding an attribute name:"pluginname" to your plugin.`,"plugin.noName"),o("function"==typeof n,`Plugin ${n.name} is a function, but should be a configuration object. Did you forget calling it? (eg: PluginName())`,"plugin.isFunction"),o("object"!=typeof n||Array.isArray(n),`Plugin ${n.name} should be a configuration of type object, but is typeof ${typeof n}.`,"plugin.wrongType"),e.plugins.push(n),n.onInit){o("function"!=typeof n.onInit,`Error in plugin "${n.name}": config.onInit must be a function but is a ${typeof n.onInit}`,"config.onInit.wrongtype"),e.log("- Execute onInit() function of plugin "+n.name);const t=n.onInit(e.config,n,e);if(t&&!t._context&&"object"==typeof t&&!Array.isArray(t))for(let n of Object.keys(t)||{})e.log("- add "+n+" to global context."),e[n]=t[n]}n.onInitPlugin&&e.onInitPlugin.tap(n.name,n.onInitPlugin),o(n.plugins&&!Array.isArray(n.plugins),`Error in plugin "${n.name}": config.plugin must be an array but is an ${typeof n.plugins}`,"config.plugin.wrongtype");for(let o of n.plugins||[])t(o,e);return e}return function(e={}){let i={plugins:[],config:e=Object.assign(e,n.configs[n.configs.length-1]||{}),_context:!0,addPlugin:t,onInitPlugin:new c(["plugin","context"]),onPreInitPlugin:new s(["config","context"]),onReturn:new c(["context"]),onPluginsInitialized:new c(["context"]),log(){e.debug&&console.log(...arguments)}};for(let t of n.configs)p(t,(n=>{n.onPreInit&&n.onPreInit(e,i)}));o(null==e,"pluginize(config,factoryConfig): factoryConfig.onPreInit returns null but should return the modified config.","factoryConfig.preInit.isNull"),o("object"!=typeof e,"pluginize(config,factoryConfig): factoryConfig.onPreInit returns a "+typeof entry+"but should return an object.","factoryConfig.preInit.wrongType"),o(Array.isArray(e),"pluginize(config,factoryConfig): factoryConfig.onPreInit returns an Array but should return an object.","factoryConfig.preInit.wrongTypeArray"),e.debug&&r("development"),e.name||(e.name="Pluginize"),i.log("Starting Pluginize."),t(a,i);for(let e of n.configs)t(e,i);t(e,i);for(let n of i.plugins)o(null==n,"error in Pluginize(config): hook onPreInitPlugin - a listener returns null but should  return an object (the modified config)","config.preInit.returnNull"),o(Array.isArray(n)||"object"!=typeof n,"error in Pluginize(config): hook onPreInitPlugin - a listener should return an object (the modified config) but returns a "+typeof n,"config.preInit.wrongType"),i.log('- call hook "onInitPlugin" of plugin '+n.name),i.onInitPlugin.call(n,i);return i.log('- call hook "onPluginsInitialized"'),i.onPluginsInitialized.call(i),i.onReturn.call(i),i.return?i[i.return]:i}}(i),factoryConfig:Object.assign(i,{level:i.level+1})})}for(let n of Object.keys(e))i[n]=e[n];return i}({level:0});Object.assign(d,{SyncHook:c,AsyncHook:f,SyncWaterfallHook:s,AsyncWaterfallHook:g,SyncBreakableHook:class extends l{call(n){const t=this.listeners();for(let n of t){if(!n(...arguments))return}}},AsyncBreakableHook:class extends l{async call(n){const t=this.listeners();for(let n of t){if(!await n(...arguments))return}}}}),n.pluginize=d,Object.defineProperty(n,"__esModule",{value:!0})}));
