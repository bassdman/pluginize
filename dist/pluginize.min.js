!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).pluginize={})}(this,(function(n){"use strict";let t="production";function e(n,e){if("development"==t)throw e;throw new Error(n)}function o(n,t,o){n&&e(t,o)}function r(n){t=n}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var u=function(n,t,e){return n(e={path:t,exports:{},require:function(n,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&e.path)}},e.exports),e.exports}((function(n,t){var e="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",u="[object Boolean]",a="[object Date]",l="[object Function]",c="[object GeneratorFunction]",s="[object Map]",f="[object Number]",g="[object Object]",p="[object Promise]",y="[object RegExp]",d="[object Set]",h="[object String]",b="[object Symbol]",w="[object WeakMap]",_="[object ArrayBuffer]",m="[object DataView]",k="[object Float32Array]",j="[object Float64Array]",v="[object Int8Array]",P="[object Int16Array]",A="[object Int32Array]",I="[object Uint8Array]",O="[object Uint8ClampedArray]",x="[object Uint16Array]",$="[object Uint32Array]",C=/\w*$/,z=/^\[object .+?Constructor\]$/,H=/^(?:0|[1-9]\d*)$/,E={};E[r]=E["[object Array]"]=E[_]=E[m]=E[u]=E[a]=E[k]=E[j]=E[v]=E[P]=E[A]=E[s]=E[f]=E[g]=E[y]=E[d]=E[h]=E[b]=E[I]=E[O]=E[x]=E[$]=!0,E["[object Error]"]=E[l]=E[w]=!1;var S="object"==typeof i&&i&&i.Object===Object&&i,T="object"==typeof self&&self&&self.Object===Object&&self,K=S||T||Function("return this")(),N=t&&!t.nodeType&&t,D=N&&n&&!n.nodeType&&n,F=D&&D.exports===N;function B(n,t){return n.set(t[0],t[1]),n}function M(n,t){return n.add(t),n}function R(n,t,e,o){var r=-1,i=n?n.length:0;for(o&&i&&(e=n[++r]);++r<i;)e=t(e,n[r],r,n);return e}function U(n){var t=!1;if(null!=n&&"function"!=typeof n.toString)try{t=!!(n+"")}catch(n){}return t}function W(n){var t=-1,e=Array(n.size);return n.forEach((function(n,o){e[++t]=[o,n]})),e}function V(n,t){return function(e){return n(t(e))}}function q(n){var t=-1,e=Array(n.size);return n.forEach((function(n){e[++t]=n})),e}var J,L=Array.prototype,Y=Function.prototype,G=Object.prototype,Q=K["__core-js_shared__"],X=(J=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",Z=Y.toString,nn=G.hasOwnProperty,tn=G.toString,en=RegExp("^"+Z.call(nn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),on=F?K.Buffer:void 0,rn=K.Symbol,un=K.Uint8Array,an=V(Object.getPrototypeOf,Object),ln=Object.create,cn=G.propertyIsEnumerable,sn=L.splice,fn=Object.getOwnPropertySymbols,gn=on?on.isBuffer:void 0,pn=V(Object.keys,Object),yn=Fn(K,"DataView"),dn=Fn(K,"Map"),hn=Fn(K,"Promise"),bn=Fn(K,"Set"),wn=Fn(K,"WeakMap"),_n=Fn(Object,"create"),mn=Wn(yn),kn=Wn(dn),jn=Wn(hn),vn=Wn(bn),Pn=Wn(wn),An=rn?rn.prototype:void 0,In=An?An.valueOf:void 0;function On(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function xn(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function $n(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var o=n[t];this.set(o[0],o[1])}}function Cn(n){this.__data__=new xn(n)}function zn(n,t){var e=qn(n)||function(n){return function(n){return function(n){return!!n&&"object"==typeof n}(n)&&Jn(n)}(n)&&nn.call(n,"callee")&&(!cn.call(n,"callee")||tn.call(n)==r)}(n)?function(n,t){for(var e=-1,o=Array(n);++e<n;)o[e]=t(e);return o}(n.length,String):[],o=e.length,i=!!o;for(var u in n)!t&&!nn.call(n,u)||i&&("length"==u||Rn(u,o))||e.push(u);return e}function Hn(n,t,e){var o=n[t];nn.call(n,t)&&Vn(o,e)&&(void 0!==e||t in n)||(n[t]=e)}function En(n,t){for(var e=n.length;e--;)if(Vn(n[e][0],t))return e;return-1}function Sn(n,t,e,o,i,p,w){var z;if(o&&(z=p?o(n,i,p,w):o(n)),void 0!==z)return z;if(!Gn(n))return n;var H=qn(n);if(H){if(z=function(n){var t=n.length,e=n.constructor(t);t&&"string"==typeof n[0]&&nn.call(n,"index")&&(e.index=n.index,e.input=n.input);return e}(n),!t)return function(n,t){var e=-1,o=n.length;t||(t=Array(o));for(;++e<o;)t[e]=n[e];return t}(n,z)}else{var S=Mn(n),T=S==l||S==c;if(Ln(n))return function(n,t){if(t)return n.slice();var e=new n.constructor(n.length);return n.copy(e),e}(n,t);if(S==g||S==r||T&&!p){if(U(n))return p?n:{};if(z=function(n){return"function"!=typeof n.constructor||Un(n)?{}:(t=an(n),Gn(t)?ln(t):{});var t}(T?{}:n),!t)return function(n,t){return Nn(n,Bn(n),t)}(n,function(n,t){return n&&Nn(t,Qn(t),n)}(z,n))}else{if(!E[S])return p?n:{};z=function(n,t,e,o){var r=n.constructor;switch(t){case _:return Kn(n);case u:case a:return new r(+n);case m:return function(n,t){var e=t?Kn(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.byteLength)}(n,o);case k:case j:case v:case P:case A:case I:case O:case x:case $:return function(n,t){var e=t?Kn(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.length)}(n,o);case s:return function(n,t,e){return R(t?e(W(n),!0):W(n),B,new n.constructor)}(n,o,e);case f:case h:return new r(n);case y:return function(n){var t=new n.constructor(n.source,C.exec(n));return t.lastIndex=n.lastIndex,t}(n);case d:return function(n,t,e){return R(t?e(q(n),!0):q(n),M,new n.constructor)}(n,o,e);case b:return i=n,In?Object(In.call(i)):{}}var i}(n,S,Sn,t)}}w||(w=new Cn);var K=w.get(n);if(K)return K;if(w.set(n,z),!H)var N=e?function(n){return function(n,t,e){var o=t(n);return qn(n)?o:function(n,t){for(var e=-1,o=t.length,r=n.length;++e<o;)n[r+e]=t[e];return n}(o,e(n))}(n,Qn,Bn)}(n):Qn(n);return function(n,t){for(var e=-1,o=n?n.length:0;++e<o&&!1!==t(n[e],e,n););}(N||n,(function(r,i){N&&(r=n[i=r]),Hn(z,i,Sn(r,t,e,o,i,n,w))})),z}function Tn(n){return!(!Gn(n)||(t=n,X&&X in t))&&(Yn(n)||U(n)?en:z).test(Wn(n));var t}function Kn(n){var t=new n.constructor(n.byteLength);return new un(t).set(new un(n)),t}function Nn(n,t,e,o){e||(e={});for(var r=-1,i=t.length;++r<i;){var u=t[r],a=o?o(e[u],n[u],u,e,n):void 0;Hn(e,u,void 0===a?n[u]:a)}return e}function Dn(n,t){var e,o,r=n.__data__;return("string"==(o=typeof(e=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==e:null===e)?r["string"==typeof t?"string":"hash"]:r.map}function Fn(n,t){var e=function(n,t){return null==n?void 0:n[t]}(n,t);return Tn(e)?e:void 0}On.prototype.clear=function(){this.__data__=_n?_n(null):{}},On.prototype.delete=function(n){return this.has(n)&&delete this.__data__[n]},On.prototype.get=function(n){var t=this.__data__;if(_n){var o=t[n];return o===e?void 0:o}return nn.call(t,n)?t[n]:void 0},On.prototype.has=function(n){var t=this.__data__;return _n?void 0!==t[n]:nn.call(t,n)},On.prototype.set=function(n,t){return this.__data__[n]=_n&&void 0===t?e:t,this},xn.prototype.clear=function(){this.__data__=[]},xn.prototype.delete=function(n){var t=this.__data__,e=En(t,n);return!(e<0)&&(e==t.length-1?t.pop():sn.call(t,e,1),!0)},xn.prototype.get=function(n){var t=this.__data__,e=En(t,n);return e<0?void 0:t[e][1]},xn.prototype.has=function(n){return En(this.__data__,n)>-1},xn.prototype.set=function(n,t){var e=this.__data__,o=En(e,n);return o<0?e.push([n,t]):e[o][1]=t,this},$n.prototype.clear=function(){this.__data__={hash:new On,map:new(dn||xn),string:new On}},$n.prototype.delete=function(n){return Dn(this,n).delete(n)},$n.prototype.get=function(n){return Dn(this,n).get(n)},$n.prototype.has=function(n){return Dn(this,n).has(n)},$n.prototype.set=function(n,t){return Dn(this,n).set(n,t),this},Cn.prototype.clear=function(){this.__data__=new xn},Cn.prototype.delete=function(n){return this.__data__.delete(n)},Cn.prototype.get=function(n){return this.__data__.get(n)},Cn.prototype.has=function(n){return this.__data__.has(n)},Cn.prototype.set=function(n,t){var e=this.__data__;if(e instanceof xn){var o=e.__data__;if(!dn||o.length<199)return o.push([n,t]),this;e=this.__data__=new $n(o)}return e.set(n,t),this};var Bn=fn?V(fn,Object):function(){return[]},Mn=function(n){return tn.call(n)};function Rn(n,t){return!!(t=null==t?o:t)&&("number"==typeof n||H.test(n))&&n>-1&&n%1==0&&n<t}function Un(n){var t=n&&n.constructor;return n===("function"==typeof t&&t.prototype||G)}function Wn(n){if(null!=n){try{return Z.call(n)}catch(n){}try{return n+""}catch(n){}}return""}function Vn(n,t){return n===t||n!=n&&t!=t}(yn&&Mn(new yn(new ArrayBuffer(1)))!=m||dn&&Mn(new dn)!=s||hn&&Mn(hn.resolve())!=p||bn&&Mn(new bn)!=d||wn&&Mn(new wn)!=w)&&(Mn=function(n){var t=tn.call(n),e=t==g?n.constructor:void 0,o=e?Wn(e):void 0;if(o)switch(o){case mn:return m;case kn:return s;case jn:return p;case vn:return d;case Pn:return w}return t});var qn=Array.isArray;function Jn(n){return null!=n&&function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=o}(n.length)&&!Yn(n)}var Ln=gn||function(){return!1};function Yn(n){var t=Gn(n)?tn.call(n):"";return t==l||t==c}function Gn(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function Qn(n){return Jn(n)?zn(n):function(n){if(!Un(n))return pn(n);var t=[];for(var e in Object(n))nn.call(n,e)&&"constructor"!=e&&t.push(e);return t}(n)}n.exports=function(n){return Sn(n,!0,!0)}}));const a={name:"DefaultPlugins",plugins:[new function(){const n=["name","hooks","init","allowKeys","disableKeyCheck","plugins","debug","preInit"];let t=!1;return{name:"ValidateConfigPlugin",hooks:{initPlugin(e,o){e.allowKeys&&n.push(...e.allowKeys),e.disableKeyCheck&&(t=e.disableKeyCheck)},pluginsInitialized(o){if(!t)for(let t of o.plugins)for(let o of Object.keys(t))n.includes(o)||e(`Config attribute "${o}" is used but not allowed. Allowed are ${n.join(", ")}. \n                            You want to disable this proove? set disableKeyCheck:true.\n                            You want to allow another config attributes? Add allowKeys:['yourkeyname'].`,"config.invalidKey")}},init:()=>({disableKeyCheck(){t=!0}})}},new function(n){return{name:"InitHooksPlugin",allowKeys:["addHooks","hooks"],hooks:{initPlugin:function(n,t){if(n.addHooks){o(Array.isArray(n.addHooks)||"object"!=typeof n.addHooks,`Error in plugin "${n.name}": config.addHooks must be an object but is a ${typeof n.addHooks}`,"config.addHooks.wrongtype");for(let e of Object.keys(n.addHooks))t.hooks[e]=n.addHooks[e]}if(n.hooks){o(Array.isArray(n.hooks)||"object"!=typeof n.hooks,`Error in plugin "${n.name}": config.hooks must be an object but is a ${typeof n.hooks}`,"config.hooks.wrongtype");for(let e of Object.keys(n.hooks))o(!t.hooks[e],'There is no Hook named "'+e+'", declared in plugin '+n.name+' . Is it correctly written? If yes, initialize it first with config attribute "addHooks"',"config.hooks.notDefined"),t.hooks[e].tap(n.name,n.hooks[e])}}},init:function(n,t,e){return n.hooks&&n.hooks.preInitPlugin&&e.hooks.preInitPlugin.tap("preInitPlugin",n.hooks.preInitPlugin),{addHooks:function(n){for(let t of Object.keys(n))e.hooks[t]=n[t]},on:function(n,t,o){if(!e.hooks[n])throw new Error('Hook with name "'+n+'" does not exist. context.on(name, pluginname, fn) failed');return e.hooks[n].tap(t,o)}}}}},new function(){const n={};return{allowKeys:["clone"],name:"ClonePlugin",hooks:{initPlugin(t,e){if(t.clone){let e,o;for(o of Object.keys(t.clone))e=t.clone[o],n[o]=e}},return(t){let e,o;for(o of Object.keys(n))e=n[o],t[e]=u(t[o])}}}},new function(){return{allowKeys:["return"],name:"ReturnPlugin",hooks:{initPlugin(n,t){n.return&&(t.return=n.return)}}}},new function(){const n={};return{allowKeys:["rename"],name:"RenamePlugin",hooks:{initPlugin(t,e){if(t.rename){let e,o;for(o of Object.keys(t.rename))e=t.rename[o],n[o]=e}},return(t){let e,o;for(o of Object.keys(n))e=n[o],t[e]=t[o],delete t[o]}}}},new function(){const n=[];return{allowKeys:["delete"],name:"DeletePlugin",hooks:{initPlugin(t,e){t.delete&&n.push(...t.delete)},return(t){for(let e of n)delete t[e]}}}}]};class l{constructor(){this._listeners={}}tap(n,t){if(null==n)throw new Error("Hook.on(): should be on(name:string, listener:function) but name is undefined");if(null==t)throw new Error("Hook.on(): should be on(name:string, listener:function) but listener is undefined");this._listeners[n]=t}off(n){if(null==n)throw new Error("Hook.off(): should be on(name:string, listener:function) but name is undefined");delete this._listeners[n]}listeners(n){return n?this._listeners[n]:Object.values(this._listeners)}}class c extends l{call(n){const t=this.listeners();for(let n of t)n(...arguments)}}class s extends l{async promise(n){const t=this.listeners();for(let n of t)await n(...arguments)}}class f extends l{call(n){let t=n;const e=this.listeners();for(let n of e){if(null==t)throw new Error("A listener in SyncWaterfallHook.trigger(context) returns null. This is not allowed. Did you forget returning sth in a listener?");t=n(t,...arguments)}return t}}class g extends l{async promise(n){let t=n;const e=this.listeners();for(let n of e)t=await n(t,...arguments);return t}}const p=function n(t={},e={}){function i(e={}){const i=u(Object.assign({configs:[]},t));let l=Array.isArray(e)?e:[e];l=l.map((n=>(n.name=n.name||"pluginize(config)",n))),i.configs.push(...l);return new n(i,{runPromise:function(n){async function t(n,e){if(e.log('- Add plugin "'+n.name+'"'),o(!(n=await e.hooks.preInitPlugin.promise(n,e)||n).name,`Plugin ${JSON.stringify(n)} has no name. Please define a name by adding an attribute name:"pluginname" to your plugin.`,"plugin.noName"),o("function"==typeof n,`Plugin ${n.name} is a function, but should be a configuration object. Did you forget calling it? (eg: PluginName())`,"plugin.isFunction"),o("object"!=typeof n||Array.isArray(n),`Plugin ${n.name} should be a configuration of type object, but is typeof ${typeof n}.`,"plugin.wrongType"),e.plugins.push(n),n.init){o("function"!=typeof n.init,`Error in plugin "${n.name}": config.init must be a function but is a ${typeof n.init}`,"config.init.wrongtype"),e.log("- Execute init() function of plugin "+n.name);const t=await n.init(e.config,n,e);if(t&&!t._context&&"object"==typeof t&&!Array.isArray(t))for(let n of Object.keys(t)||{})e.log("- add "+n+" to global context."),e[n]=t[n]}n.hooks&&n.hooks.initPlugin&&await e.hooks.initPlugin.tap(n.name,n.hooks.initPlugin),o(n.plugins&&!Array.isArray(n.plugins),`Error in plugin "${n.name}": config.plugin must be an array but is an ${typeof n.plugins}`,"config.plugin.wrongtype");for(let o of n.plugins||[])await t(o,e);return e}return async function(e={}){let i={plugins:[],config:e=Object.assign(e,n.configs[n.configs.length-1]||{}),_context:!0,addPlugin:t,hooks:{return:new s(["context"]),preInitPlugin:new g(["config","context"]),pluginsInitialized:new s(["context"]),initPlugin:new s(["plugin","context"])},log(){e.debug&&console.log(...arguments)}};for(let t of n.configs)t.preInit&&t.preInit(e,i);o(null==e,"pluginize(config,factoryConfig): factoryConfig.preInit returns null but should return the modified config.","factoryConfig.preInit.isNull"),o("object"!=typeof e,"pluginize(config,factoryConfig): factoryConfig.preInit returns a "+typeof entry+"but should return an object.","factoryConfig.preInit.wrongType"),o(Array.isArray(e),"pluginize(config,factoryConfig): factoryConfig.preInit returns an Array but should return an object.","factoryConfig.preInit.wrongTypeArray"),e.debug&&r("development"),e.name||(e.name="PluginizeAsync"),i.log("Starting Pluginize."),await t(a,i);for(let e of n.configs)await t(e,i);await t(e,i);for(let n of i.plugins)o(null==n,"error in Pluginize(config): hook preInitPlugin - a listener returns null but should  return an object (the modified config)","config.preInit.returnNull"),o(Array.isArray(n)||"object"!=typeof n,"error in Pluginize(config): hook preInitPlugin - a listener should return an object (the modified config) but returns a "+typeof n,"config.preInit.wrongType"),i.log('- call hook "initPlugin" of plugin '+n.name),await i.hooks.initPlugin.promise(n,i);return i.log('- call hook "pluginsInitialized"'),await i.hooks.pluginsInitialized.promise(i),await i.hooks.return.promise(i),i.return?i[i.return]:i}}(i),run:function(n){function t(n,e){if(e.log('- Add plugin "'+n.name+'"'),o(null==(n=e.hooks.preInitPlugin.call(n,e)||n),"Error: Plugin is null","conf.isNull"),o(!n.name,`Plugin ${JSON.stringify(n)} has no name. Please define a name by adding an attribute name:"pluginname" to your plugin.`,"plugin.noName"),o("function"==typeof n,`Plugin ${n.name} is a function, but should be a configuration object. Did you forget calling it? (eg: PluginName())`,"plugin.isFunction"),o("object"!=typeof n||Array.isArray(n),`Plugin ${n.name} should be a configuration of type object, but is typeof ${typeof n}.`,"plugin.wrongType"),e.plugins.push(n),n.init){o("function"!=typeof n.init,`Error in plugin "${n.name}": config.init must be a function but is a ${typeof n.init}`,"config.init.wrongtype"),e.log("- Execute init() function of plugin "+n.name);const t=n.init(e.config,n,e);if(t&&!t._context&&"object"==typeof t&&!Array.isArray(t))for(let n of Object.keys(t)||{})e.log("- add "+n+" to global context."),e[n]=t[n]}n.hooks&&n.hooks.initPlugin&&e.hooks.initPlugin.tap(n.name,n.hooks.initPlugin),o(n.plugins&&!Array.isArray(n.plugins),`Error in plugin "${n.name}": config.plugin must be an array but is an ${typeof n.plugins}`,"config.plugin.wrongtype");for(let o of n.plugins||[])t(o,e);return e}return function(e={}){let i={plugins:[],config:e=Object.assign(e,n.configs[n.configs.length-1]||{}),_context:!0,addPlugin:t,hooks:{return:new c(["context"]),preInitPlugin:new f(["config","context"]),pluginsInitialized:new c(["context"]),initPlugin:new c(["plugin","context"])},log(){e.debug&&console.log(...arguments)}};for(let t of n.configs)t.preInit&&t.preInit(e,i);o(null==e,"pluginize(config,factoryConfig): factoryConfig.preInit returns null but should return the modified config.","factoryConfig.preInit.isNull"),o("object"!=typeof e,"pluginize(config,factoryConfig): factoryConfig.preInit returns a "+typeof entry+"but should return an object.","factoryConfig.preInit.wrongType"),o(Array.isArray(e),"pluginize(config,factoryConfig): factoryConfig.preInit returns an Array but should return an object.","factoryConfig.preInit.wrongTypeArray"),e.debug&&r("development"),e.name||(e.name="Pluginize"),i.log("Starting Pluginize."),t(a,i);for(let e of n.configs)t(e,i);t(e,i);for(let n of i.plugins)o(null==n,"error in Pluginize(config): hook preInitPlugin - a listener returns null but should  return an object (the modified config)","config.preInit.returnNull"),o(Array.isArray(n)||"object"!=typeof n,"error in Pluginize(config): hook preInitPlugin - a listener should return an object (the modified config) but returns a "+typeof n,"config.preInit.wrongType"),i.log('- call hook "initPlugin" of plugin '+n.name),i.hooks.initPlugin.call(n,i);return i.log('- call hook "pluginsInitialized"'),i.hooks.pluginsInitialized.call(i),i.hooks.return.call(i),i.return?i[i.return]:i}}(i),factoryConfig:Object.assign(i,{level:i.level+1})})}for(let n of Object.keys(e))i[n]=e[n];return i}({level:0});n.AsyncBreakableHook=class extends l{async call(n){const t=this.listeners();for(let n of t){if(!await n(...arguments))return}}},n.AsyncHook=s,n.AsyncWaterfallHook=g,n.SyncBreakableHook=class extends l{call(n){const t=this.listeners();for(let n of t){if(!n(...arguments))return}}},n.SyncHook=c,n.SyncWaterfallHook=f,n.pluginize=p,Object.defineProperty(n,"__esModule",{value:!0})}));
